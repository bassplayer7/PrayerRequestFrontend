define(["jquery","PubSub","evt","HandleBars","text!./template/request.html"],function($,t,e,i,n){var d=function(t){this.model=t;var e=this,d=i.compile(n),l=$(d(this.model));l.find(".action-delete").click(e.initRequestRemove.bind(this)),l.find(".action-answer").click(e.initToggleAnswered.bind(this)),l.find(".action-edit").click(e.initRequestUpdate.bind(this)),l.find(".button-update").click(e.finishEdit.bind(this)),l.find(".button-cancel").click(e.cancelEdit.bind(this)),this.getElement=function(){return l}};return d.prototype.initRequestRemove=function(){var t=this.getElement(),i=$('<span class="status-text">(deleting)</span>');t.addClass("delete"),t.find(".item-title").after(i),this._publishEvent(e.REQUEST_DELETE_INIT,t)},d.prototype.initToggleAnswered=function(){var t=this.getElement(),i=$('<span class="status-text green">(updating)</span>');t.addClass("answer"),t.find(".item-title").after(i),this._publishEvent(e.REQUEST_ANSWERED_INIT,t)},d.prototype.initRequestUpdate=function(){var t=this.getElement(),e=t.find(".title-edit"),i=t.find(".date-edit");this.model.OldTitle=this.model.Title,this.model.OldDate=this.model.Date,t.addClass("edit-mode"),e.val(this.model.Title).focus(),i.val(this.model.Date),this.keyActions()},d.prototype.cancelEdit=function(){var t=this.getElement();this.model.Title=this.model.OldTitle,this.model.Date=this.model.OldDate,t.find(".item-title").text(this.model.OldTitle),t.find(".item-date").text(this.model.OldDate),this._publishEvent(e.REQUEST_UPDATE_END,t)},d.prototype.finishEdit=function(){var t=this.getElement(),i=t.find(".title-edit").val(),n=t.find(".date-edit").val(),d=t.find(".button-update");t.find(".item-title").text(i),t.find(".item-date").text(n),this.model.Title=i,this.model.Date=n,d.text("saving...").prop("disabled",!0),this._publishEvent(e.REQUEST_UPDATE_SAVE,t)},d.prototype._publishEvent=function(e,i){t.publish(e,{model:this.model,element:i})},d.prototype.keyActions=function(){var t=this,e=this.getElement();e.keydown(function(e){13===e.which&&t.finishEdit.call(t),27===e.which&&t.cancelEdit.call(t)})},d});