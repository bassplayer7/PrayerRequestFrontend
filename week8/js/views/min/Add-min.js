define(["jquery","HandleBars","PubSub","evt","errorMsg","text!./template/add.html","BootstrapTab"],function($,t,e,i,n,o){var r=function(){var t=this;this.setup=function(){this.registerOpenInputClick(),e.subscribe(i.REQUEST_NEW_COMPLETE,this.completeAddRequest.bind(this)),e.subscribe(i.REQUEST_NEW_ERROR,this.displayError.bind(this)),$(document).keydown(function(e){$(":focus").is("input")||(67===e.which?(e.preventDefault(),t.showInput.apply(t)):85===e.which?(e.preventDefault(),$('.nav-tabs a[href="#unanswered"]').tab("show")):65===e.which&&(e.preventDefault(),$('.nav-tabs a[href="#answered"]').tab("show")))})},this.setup()};return r.prototype.buttonText=void 0,r.prototype.button=void 0,r.prototype.container=$(".add-request-container"),r.prototype.getContainer=function(){return this.container},r.prototype.getInput=function(){return $("#add_request_input")},r.prototype.getTitle=function(){return $("#add_request_title")},r.prototype.getDate=function(){return $("#add_request_date")},r.prototype.getButton=function(){return void 0!==this.button?this.button:$("#add_request")},r.prototype.registerOpenInputClick=function(){var t=this;this.getButton().off("click").click(t.showInput.bind(t))},r.prototype.registerSubmitRequestClick=function(){var t=this;this.getButton().off("click").click(t.submitRequest.bind(t))},r.prototype.hideInput=function(){this.getInput().remove(),this.getErrorElement().addClass("hidden"),void 0!==this.buttonText&&(this.getButton().text(this.buttonText).removeClass("opened").removeClass("sending").prop("disabled",!1),this.registerOpenInputClick())},r.prototype.addRequest=function(t,n){return"string"!=typeof t?!1:void e.publish(i.REQUEST_NEW_INIT,{Title:t,Date:n})},r.prototype.submitRequest=function(){var t=this.getTitle().val();t&&(this.getButton().text("Sending...").prop("disabled",!0),this.getInput().addClass("sending"),this.addRequest(t,this.getDate().val()))},r.prototype.keyActions=function(t){var e=this;t.off("keydown"),t.keydown(function(t){13===t.which&&e.submitRequest.call(e),27===t.which&&e.hideInput()})},r.prototype.showInput=function(){if(this.getInput().length>=1)return!1;var e=t.compile(o),i=this.getButton();this.buttonText=i.text(),this.button=i,i.before(e),i.text("Save").addClass("opened"),this.registerSubmitRequestClick(),this.keyActions(i.parent()),this.getTitle().focus()},r.prototype.completeAddRequest=function(){this.hideInput(),this.getErrorElement().addClass("hidden")},r.prototype.enableAddRequest=function(){this.getButton().text("Try Again").prop("disabled",!1),this.getInput().removeClass("sending")},r.prototype.getErrorElement=function(){if(void 0===this.errorEl){var t=$("<div></div>");t.addClass("add-request-error"),this.getContainer().append(t),this.errorEl=t}return this.errorEl.text("").removeClass("hidden"),this.errorEl},r.prototype.displayError=function(t,e){this.enableAddRequest(),this.getErrorElement().text(n[e.status])},r});