define(["jquery","HandleBars","PubSub","evt","text!./template/add.html","BootstrapTab"],function($,t,e,i,n){var o=function(){var t=this;this.setup=function(){this.registerOpenInputClick(),e.subscribe(i.REQUEST_NEW_COMPLETE,this.completeAddRequest.bind(this)),e.subscribe(i.REQUEST_NEW_ERROR,this.displayError.bind(this)),$(document).keydown(function(e){$(":focus").is("input")||(67===e.which?(e.preventDefault(),t.showInput.apply(t)):85===e.which?(e.preventDefault(),$('.nav-tabs a[href="#unanswered"]').tab("show")):65===e.which&&(e.preventDefault(),$('.nav-tabs a[href="#answered"]').tab("show")))})},this.setup()};return o.prototype.buttonText=void 0,o.prototype.button=void 0,o.prototype.container=$(".add-request-container"),o.prototype.getContainer=function(){return this.container},o.prototype.getInput=function(){return $("#add_request_input")},o.prototype.getTitle=function(){return $("#add_request_title")},o.prototype.getDate=function(){return $("#add_request_date")},o.prototype.getButton=function(){return void 0!==this.button?this.button:$("#add_request")},o.prototype.registerOpenInputClick=function(){var t=this;this.getButton().off("click").click(t.showInput.bind(t))},o.prototype.registerSubmitRequestClick=function(){var t=this;this.getButton().off("click").click(t.submitRequest.bind(t))},o.prototype.hideInput=function(){this.getInput().remove(),this.getErrorElement().addClass("hidden"),void 0!==this.buttonText&&(this.getButton().text(this.buttonText).removeClass("opened").removeClass("sending").prop("disabled",!1),this.registerOpenInputClick())},o.prototype.addRequest=function(t,n){return"string"!=typeof t?!1:void e.publish(i.REQUEST_NEW_INIT,{Title:t,Date:n})},o.prototype.submitRequest=function(){var t=this.getTitle().val();t&&(this.getButton().text("Sending...").prop("disabled",!0),this.getInput().addClass("sending"),this.addRequest(t,this.getDate().val()))},o.prototype.keyActions=function(t){var e=this;t.off("keydown"),t.keydown(function(t){13===t.which&&e.submitRequest.call(e),27===t.which&&e.hideInput()})},o.prototype.showInput=function(){if(this.getInput().length>=1)return!1;var e=t.compile(n),i=this.getButton();this.buttonText=i.text(),this.button=i,i.before(e),i.text("Save").addClass("opened"),this.registerSubmitRequestClick(),this.keyActions(i.parent()),this.getTitle().focus()},o.prototype.completeAddRequest=function(){this.hideInput(),this.getErrorElement().addClass("hidden")},o.prototype.enableAddRequest=function(){this.getButton().text("Try Again").prop("disabled",!1),this.getInput().removeClass("sending")},o.prototype.getErrorElement=function(){if(void 0===this.errorEl){var t=$("<div></div>");t.addClass("add-request-error"),this.getContainer().append(t),this.errorEl=t}return this.errorEl.text("").removeClass("hidden"),this.errorEl},o.prototype.displayError=function(t,e){this.enableAddRequest(),400===e.status&&this.getErrorElement().text("There was a problem with the request. Please try something else."),403===e.status&&this.getErrorElement().text("It doesn't look like your user has been saved correctly."),409===e.status&&this.getErrorElement().text("You already have a request with the same title.")},o});